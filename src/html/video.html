<!DOCTYPE html>
<html>
  <head>
    <title>Pathfora CSS Playground</title>
  </head>
  <body>
    <script src="https://c.lytics.io/static/pathfora.min.js"></script>

    <script>
      var vidModal = new pathfora.Form({
        id: 'vidModal',
        layout: 'modal',
        headline: 'A Special Message from Marc Lichtenfeld...',
        msg: 'Click play button to listen',
        className: 'pf-video-OC',
        showForm: false,
        cancelShow: false,
        okMessage: 'UPGRADE NOW',
        formElements: [
          {
            'type': 'text',
            'name': 'email',
            'label': '',
            'placeholder': 'Enter email...',
            'required': true
          }
        ],
        confirmAction: {
          name: 'upgrade',
          close: false,
          callback: function (event, payload) {
            for (var i = 0; i < payload.data.length; i++) {
              if (payload.data[i].name === "email") {
                // do things that need to happen
                // window.open("https://signupapp2.com/signupapp/signups/process/legacy?listCode=WEALTHRE&sourceId=X302UA07&email_page=_pge_wr_generic&redirectUrl=https://readyfireaim.eu/about-us/&emailAddress=" + payload.data[i].value, "_blank");
                var email = payload.data[i].value;
                var data = JSON.stringify({
                  "signup": { 
                      "listCode": "WEALTHRE",
                      "email_page": "_pge_wr_generic",
                      "sourceId": "X302UA07",
                      "emailAddress": email
                      }
                });
                var xhr = new XMLHttpRequest();
                var url = "https://signupapp2.com/signupapp/signups/process";
                xhr.withCredentials = true;
                xhr.onreadystatechange = function () {
                  if (this.readyState === 4) { 
                    console.log(this.responseText); 
                  }
                };
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Cache-Control", "no-cache");
                xhr.send(data);


                // Overwrite with a thank you note because we aren't closing the modal
                // Overwrite Header
                var okBtn = document.querySelector(".pf-video-OC .pf-widget-ok");
                okBtn.style.display = 'none';
                var h = document.querySelector(".pf-widget.pf-video-OC .pf-widget-headline");
                h.innerHTML = "Thank You for Signing Up for Wealthy Retirement!";
                h.setAttribute("style", "margin: 0");
                var b = document.querySelector(".pf-widget.pf-video-OC .pf-widget-body");
                var imageElement = document.createElement("img");
                imageElement.setAttribute("src", "https://lytics.github.io/pathforadocs/assets/lion.jpg");
                var imageDiv = document.createElement("span");
                imageDiv.appendChild(imageElement);
                b.insertAdjacentElement("beforebegin", imageDiv);
                var e = document.querySelector(".pf-video-OC .pf-widget-container .pf-va-middle .pf-widget-content .pf-widget-body .pf-va-middle");
                e.innerHTML = "<div>You've just taken the first step towards reaching the retirement of your dreams. What's next?" +
                  "</br></br>First, <a href=\"\">check out our website</a> - it's full of helpful retirement planning resources and investing research advice." +
                  "</br></br>And with your new subscription, you'll receive daily tips and proven strategies for growing your income, reducint risk and building a better future for you and your famil" +
                  "</div>";
              }
            }
          }
        },
        "onLoad": function(event, module) {
            var okBtn = document.querySelector(".pf-video-OC .pf-widget-ok");
            okBtn.style.display = 'none';
            setTimeout (function() {okBtn.style.display = ""}, 10000);
            var e = document.querySelector(".pf-video-OC .pf-widget-container .pf-va-middle .pf-widget-content .pf-widget-body .pf-va-middle");
            var d1 = document.createElement("div");
            var s1 = document.createElement("script");
            var s2 = document.createElement("script");
            s1.setAttribute("type", "text/javascript");
            s1.setAttribute("src", "https://fast.wistia.com/embed/medias/7jgrv19vxw.jsonp");
            s2.setAttribute("type", "text/javascript");
            s2.setAttribute("src", "https://fast.wistia.com/assets/external/E-v1.js");
            var embedString = '<div class="wistia_responsive_padding" style="padding:52.71% 0 0 0;position:relative;"><div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;"><span class="wistia_embed wistia_async_7jgrv19vxw popover=true popoverAnimateThumbnail=true videoFoam=true" style="display:inline-block;height:100%;position:relative;width:100%"> </span></div></div>';
            d1.insertAdjacentElement("beforeend",s1);
            d1.insertAdjacentElement("beforeend",s2);
            d1.insertAdjacentHTML("beforeend", embedString);
            e.insertAdjacentElement("afterbegin", d1);
        }
      });

      // load custom css
      var head  = document.getElementsByTagName('head')[0];
      var link  = document.createElement('link');
      var cssfile = 'lytics_overrides.css';
      link.rel  = 'stylesheet';
      link.type = 'text/css';
      link.href = cssfile;
      head.appendChild(link);

      // initialize widgets
      pathfora.initializeWidgets([vidModal]);
    </script>
  </body>
</html>