<!DOCTYPE html>
<html>
  <head>
    <title>Pathfora CSS Playground</title>
  </head>
  <body>
    <script src="https://c.lytics.io/static/pathfora.min.js"></script>

    <script>
      var vidModal = new pathfora.Form({
        id: 'vidModal',
        layout: 'modal',
        headline: 'A Special Message from Marc Lichtenfeld...',
        msg: 'Click play button to listen',
        className: 'pf-video-OC',
        showForm: false,
        cancelShow: false,
        okMessage: 'SIGN UP',
        formElements: [
          {
            'type': 'text',
            'name': 'email',
            'label': '',
            'placeholder': 'Enter email...',
            'required': true
          }
        ],
        confirmAction: {
          name: 'signup',
          close: false,
          callback: function (event, payload) {
            for (var i = 0; i < payload.data.length; i++) {
              if (payload.data[i].name === "email") {
                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;
                xhr.onreadystatechange = function () {
                  if (this.readyState === 4) { 
                    console.log(this.responseText); 
                  }
                };
                var email = payload.data[i].value;
                var data = JSON.stringify({
                  "signup": { 
                      "listCode": "WEALTHRE",
                      "welcomeEmailTemplateName": "_pge_wr_generic",
                      "sourceId": "X302UA07",
                      "emailAddress": email
                      }
                });
                var url = "https://signupapp2.com/signupapp/signups/process";
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Cache-Control", "no-cache");
                xhr.send(data);
                // Overwrite with a thank you note because we aren't closing the modal
                var okBtn = document.querySelector(".pf-video-OC .pf-widget-ok");
                okBtn.style.display = 'none';
                var h = document.querySelector(".pf-widget.pf-video-OC .pf-widget-headline");
                h.innerHTML = "Thank You for Signing Up for Wealthy Retirement!";
                h.setAttribute("style", "margin: 0;");
                var b = document.querySelector(".pf-widget.pf-video-OC .pf-widget-body");
                var imageElement = document.createElement("img");
                imageElement.setAttribute("src", "https://s3.amazonaws.com/assets.wealthyretirement.com/images/thank-you-image.jpg");
                imageElement.setAttribute("style", "width:100%; height:auto;");
                var imageSpan = document.createElement("span");
                var imageDiv = document.createElement("div");
                imageDiv.appendChild(imageElement);
                imageSpan.appendChild(imageDiv);
                b.insertAdjacentElement("beforebegin", imageSpan);
                var e = document.querySelector(".pf-video-OC .pf-widget-container .pf-va-middle .pf-widget-content .pf-widget-body .pf-va-middle");
                e.innerHTML = "<div align=\"left\">You've just taken the first step towards reaching the retirement of your dreams. What's next?" +
                  "</br></br>First, <b><u>check out our website</u></b> - it's full of helpful retirement planning resources and investing research advice." +
                  "</br></br>And with your new subscription, you'll receive daily tips and proven strategies for growing your income, reducing risk and building a better future for you and your family" +
                  "</div>";
              }
            }
          }
        },
        "onLoad": function(event, module) {
            var cancelBtn = document.querySelector(".pf-video-OC .pf-widget-cancel");
            if (cancelBtn) {
              cancelBtn.style.display = 'none';
            }
            var okBtn = document.querySelector(".pf-video-OC .pf-widget-ok");
            okBtn.style.display = 'none';
            setTimeout (function() {okBtn.style.display = ""}, 10000);
            var e = document.querySelector(".pf-video-OC .pf-widget-container .pf-va-middle .pf-widget-content .pf-widget-body .pf-va-middle");
            var d1 = document.createElement("div");
            // new embed code
            var iframeDiv = "<div class=\"wistia_responsive_padding\" style=\"padding:52.71% 0 0 0;position:relative;\"><div class=\"wistia_responsive_wrapper\" style=\"height:100%;left:0;position:absolute;top:0;width:100%;\"><iframe src=\"https://fast.wistia.net/embed/iframe/7jgrv19vxw?videoFoam=true\" title=\"Wistia video player\" allowtransparency=\"true\" frameborder=\"0\" scrolling=\"no\" class=\"wistia_embed\" name=\"wistia_embed\" allowfullscreen mozallowfullscreen webkitallowfullscreen oallowfullscreen msallowfullscreen width=\"100%\" height=\"100%\"></iframe></div></div>";
            var iframeScript = document.createElement("script");
            iframeScript.setAttribute("type", "text/javascript");
            iframeScript.setAttribute("src", "https://fast.wistia.net/assets/external/E-v1.js");
            d1.insertAdjacentHTML("beforeend", iframeDiv);
            d1.insertAdjacentElement("beforeend", iframeScript);
/* Old Embed Code
            var s1 = document.createElement("script");
            var s2 = document.createElement("script");
            s1.setAttribute("type", "text/javascript");
            s1.setAttribute("src", "https://fast.wistia.com/embed/medias/7jgrv19vxw.jsonp");
            s2.setAttribute("type", "text/javascript");
            s2.setAttribute("src", "https://fast.wistia.com/assets/external/E-v1.js");
            var embedString = '<div class="wistia_responsive_padding" style="padding:52.71% 0 0 0;position:relative;"><div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;"><span class="wistia_embed wistia_async_7jgrv19vxw popover=true popoverAnimateThumbnail=true videoFoam=true" style="display:inline-block;height:100%;position:relative;width:100%"> </span></div></div>';
            d1.insertAdjacentElement("beforeend",s1);
            d1.insertAdjacentElement("beforeend",s2);
            d1.insertAdjacentHTML("beforeend", embedString);
*/
            e.insertAdjacentElement("afterbegin", d1);
        }
      });

      // load custom css
      var head  = document.getElementsByTagName('head')[0];
      var link  = document.createElement('link');
      var cssfile = 'lytics_overrides.css';
      link.rel  = 'stylesheet';
      link.type = 'text/css';
      link.href = cssfile;
      head.appendChild(link);

      // initialize widgets
      pathfora.initializeWidgets([vidModal]);
    </script>
  </body>
</html>